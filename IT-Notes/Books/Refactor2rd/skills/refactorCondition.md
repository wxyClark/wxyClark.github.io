---
sort: 4
---

# 简化条件表达式

```tip
清晰表达“在主要处理逻辑之前先做检查”的意图
```

## 分解条件表达式（Decompose Conditional）

| title | content |
| ---- | ---- |
| 场景 | 你有一个复杂的条件（if-then-else）语句 |
| 意义 | 简化逻辑 |
| 定义 | 从if、then、else三分段落中分别提炼出独立函数。 |
| 做法 | 对条件判断和每个条件分支分别运用【提炼函数】手法。<br>提炼完成后，我喜欢用三元运算符重新安排条件语句。<br>charge = summer() ? summerCharge() : regularCharge(); |
| 注意 | 不同分支应返回相同数据类型 |

## 合并条件表达式（Consolidate Conditional Expression）

| title | content |
| ---- | ---- |
| 场景 | 你有一系列条件测试，都得到相同结果。 |
| 意义 | 条件语句的合并理由也同时指出了不要合并的理由：如果我认为这些检查的确彼此独立，的确不应该被视为同一次检查，我就不会使用本项重构。 |
| 定义 | 将这些测试合并为一个条件表达式，并将这个条件表达式提炼成为一个独立函数 |
| 做法 | 使用适当的逻辑运算符，将两个相关条件表达式合并为一个。<br>顺序执行的条件表达式用逻辑或来合并，嵌套的if语句用逻辑与来合并。 |
| 注意 | 保持数据格式不变 |

## 以卫语句取代嵌套条件表达式（Replace Nested Conditional with Guard Clauses）

```tip
以卫语句取代嵌套条件表达式的精髓就是：给某一条分支以特别的重视。

如果使用if-then-else结构，你对if分支和else分支的重视是同等的
```

| title | content |
| ---- | ---- |
| 场景 | 函数中的条件逻辑使人难以看清正常的执行路径。 |
| 定义 |  |
| 意义 | 使用卫语句表现所有的特殊情况。 |
| 做法 | 一开始我把它设为0，代表卫语句被触发时的返回值；然后又用最终计算的结果给它赋值。<br>我可以彻底移除这个变量，避免用一个变量承担两重责任，而且又减少了一个可变变量。 |
| 注意 | 我们常常可以将条件表达式反转，从而实现以卫语句取代嵌套条件表达式。 |

## 以多态取代条件表达式（Replace Conditional with Polymorphism）

```tip
函数名中的“And”字样说明其中包含了两件事，所以我觉得应该将它们分开
```

| title | content |
| ---- | ---- |
| 场景 | 如果现有的类尚不具备多态行为，就用工厂函数创建之，令工厂函数返回恰当的对象实例。<br>你手上有个条件表达式，它根据对象类型的不同选择不同的行为 |
| 意义 | <br> |
| 定义 | 将这个条件表达式的每个分支放进一个子类内的覆写函数中，然后将原始函数声明为抽象函数。 |
| 做法 | 在调用方代码中使用工厂函数获得对象实例。<br>将带有条件逻辑的函数移到超类中 |
| 注意 | <br> |

## 引入特例（Introduce Special Case）

| title | content |
| ---- | ---- |
| 场景 | 一种常见的重复代码是这种情况：一个数据结构的使用者都在检查某个特殊的值，并且当这个特殊值出现时所做的处理也都相同。<br>如果我发现代码库中有多处以同样方式应对同一个特殊值，我就会想要把这个处理逻辑收拢到一处。 |
| 意义 | <br> |
| 定义 |  |
| 做法 | 使用“特例”（Special Case）模式：<br> 创建一个特例元素，用以表达对这种特例的共用行为的处理。<br>这样我就可以用一个函数调用取代大部分特例检查逻辑。 |
| 注意 | 你需要再三检查某对象是否为null。将null值替换为null对象。 |

## 移除控制标记（Remove Control Flag）

| title | content |
| ---- | ---- |
| 场景 | 在一系列布尔表达式中，某个变量带有“控制标记”的作用。 |
| 定义 | 以break语句或return语句取代控制标记。 |
| 意义 | 简化逻辑，明确处理顺序 |
| 做法 | <br> |
| 注意 | <br> |

## demo

| title | content |
| ---- | ---- |
| 场景 | <br> |
| 意义 | <br> |
| 定义 | <br> |
| 做法 | <br> |
| 注意 | <br> |