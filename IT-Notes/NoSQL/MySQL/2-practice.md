---
sort: 2
---

# MySQL实践


## 开发规范

* 禁止在开发环境做测试
* 前后端必须会用一致的字符集(utf8mb4)
* 编写SQL语句 关键词必须全部为大写，每个词必只允许只有一个空格符
* 建议使用预编译语句进行数据库操作
* 关联字段的数量类型、范围 与源数据保持一致

### 命名规范
[分享一份大佬的MySQL数据库设计规范，值得收藏](https://zhuanlan.zhihu.com/p/165940906)

```danger
命名使用小写字母、下划线、数字，字母开头，表意明确
```

* 【创建数据库】必须显式指定字符集，并且字符集只能是utf8或者utf8mb4
* 【库的名称】32个字符以内，业务系统名称_子系统名，分库名称：库通配名_编号/时间
* 【表的名称】32个字符以内，显式指定字符集为utf8或utf8mb4。必须有comment
* 【中间表】用于保留中间结果集，名称必须以tmp_开头，以日期结束
* 【备份表】用于备份或抓取源表快照，名称必须以bak_开头。中间表和备份表定期清理
* 相关模块的表名(前缀标识)与表名之间【尽量体现join关系】,如user表和user_login表
* 【列的名称】32个字符以内，必须有comment，枚举值在comment中罗列
* 【索引名称】主键的名称以“pk_”开头，唯一键以“uk_”或“uq_”开头，普通索引以“idx_”开头，一律使用小写格式，以表名/字段的名称或缩写作为后缀

### 数据表设计规范

```danger
必须显式指定表存储引擎类型，如无特殊需求，一律为InnoDB
尽量避免null值
```

* 【*】所有存储相同数据的列名和列类型必须一致，
* 【*】禁止使用预留字段，禁止存储图片、文件等二进制数据
* 【*】数据库环境隔离，开发、测试环境不能使用生产库
* 【*】一个表最多20个字段，数据冷热分离，减少列的宽度

* 核心表必须设置字段：create_at、updated_at、updated_by,便于查问题
* (建表预估)数据量大的表做分表设计，id自增bigInt，业务_id使用分布式ID(bigInt)
* 表中所有字段尽可能都是NOT NULL属性
```
MySQL8之前版本Text、blob、json设为NUll，垂直拆分到其他表里
NULL值会存在每一行都会占用额外空间、数据迁移容易出错、聚合计算结果偏差
```

* 【反范式设计】把经常需要join查询的字段，在其他表里冗余一份，减少join查询

### 字段设计规范

```danger
优先选择符合存储需要的最小数据类型，优先使用整数类型
```

* 自增列推荐使用bigint类型无符号数
* IP地址字段推荐使用int类型(4字节)，不推荐用char(15)（至少15字节）
* 存储金钱的字段，建议用int(除以100得到两位小数)，double占用8字节，空间浪费
* 区分度小的status、type等字段推荐使用tinytint或者smallint类型节省存储空间。
* 时间类型尽量选取timestamp（4字节），datetime（8字节），禁止使用字符串存储日期时间
* 文本数据尽量用varchar(2+n)存储(20 < n > 2700)。因为varchar是变长存储，比char更省空间,但是会产生碎片。

```
Innodb中当一行记录超过8098字节[[8098/3=2699.3]]时，会将该记录中选取最长的一个字段将其768字节放在原始page里，该字段余下内容放在overflow-page里。
不幸的是在compact行格式下，原始page和overflow-page都会加载

varchar最多存65535字节(在utf8字符集下最多存21844个字符,超过会自动转换为mediumtext字段[最多存2^24/3个字符],longtext最多存2^32/3个字符。一般建议用varchar类型，字符数不要超过2700[8098/3=2699.3]。),
```

* 不推荐使用enum，set，浪费空间，更新不方便。推荐使用tinyint或smallint。
* 不推荐使用blob，text等类型。它们都比较浪费硬盘和内存空间。

### SQL使用规范